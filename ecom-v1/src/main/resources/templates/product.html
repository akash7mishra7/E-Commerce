<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{base::layout(~{::section})}">
<head>
<meta charset="ISO-8859-1">
<title>Products - Shopping Experience</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<style>
    @charset "ISO-8859-1";
    
    .card-sh {
        box-shadow: 0 0 3px 0 rgba(0, 0, 0, 0.3);
    }
    
    .cat-div {
        box-shadow: 0 0 10px rgba(0, 0, 0, .1);
    }
    
    .error {
        color: red;
    }
    
    .category-card {
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .product-card {
        transition: transform 0.3s;
        border: none;
        border-radius: 10px;
        overflow: hidden;
        height: 100%;
    }
    
    .product-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }
    
    .section-title {
        position: relative;
        margin-bottom: 1.5rem;
        font-weight: 700;
    }
    
    .section-title:after {
        content: '';
        display: block;
        width: 50px;
        height: 3px;
        background: #0d6efd;
        margin: 10px 0;
    }
    
    .category-list .list-group-item {
        border: none;
        border-left: 3px solid transparent;
        padding: 0.75rem 1.25rem;
    }
    
    .category-list .list-group-item.active {
        background-color: rgba(13, 110, 253, 0.1);
        color: #0d6efd;
        font-weight: 600;
        border-left-color: #0d6efd;
    }
    
    .category-list .list-group-item:hover:not(.active) {
        background-color: #f8f9fa;
    }
    
    .search-container {
        background: linear-gradient(45deg, #6c5ce7, #0d6efd);
        padding: 2rem 0;
        margin-top: 2rem;
        border-radius: 0 0 20px 20px;
    }
    
    .discount-percent {
        color: #28a745;
        font-weight: 500;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
</style>
</head>
<body>
	<section>
		<!-- Search Section -->
		<div class="search-container">
			<div class="container">
				<div class="row justify-content-center">
					<div class="col-md-8">
						<form action="/products" method="get">
							<div class="input-group shadow-lg rounded-pill">
								<input type="text" class="form-control rounded-pill me-2" 
								       name="ch" placeholder="Search for products..." 
								       style="border: none; padding: 0.8rem 1.5rem;">
								<button class="btn btn-light rounded-pill px-4" type="submit">
									<i class="fas fa-magnifying-glass me-2"></i> Search
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

		<div class="container mt-4">
			<div class="row">

				<!-- Category Sidebar -->
				<div class="col-md-3">
					<div class="card category-card shadow-sm p-4 mb-4">
						<h5 class="section-title">Categories</h5>
						<div class="list-group category-list">
							<a href="/products"
								th:classappend="${paramValue==''} ? 'active':''"
								class="list-group-item list-group-item-action d-flex align-items-center"
								aria-current="true">
								<i class="bi bi-grid-3x3-gap me-2"></i> All Categories
							</a> 
							<a th:each="c:${categories}"
								th:href="@{'/products?category='+${c.name}}"
								th:classappend="${paramValue == c.name} ? 'active':''"
								class="list-group-item list-group-item-action d-flex align-items-center">
								<i class="bi bi-tag me-2"></i> [[${c.name}]]
							</a>
						</div>
					</div>
				</div>
				
				<!-- Products Section -->
				<div class="col-md-9">
					<div class="card shadow-sm p-3 mb-5 bg-body-tertiary rounded">
						<div class="card-body">
							<h3 class="text-center section-title">Products</h3>
							
							<!-- Products Grid -->
							<div class="row">
								<th:block th:if="${products.size() > 0}">
									<div class="col-md-3 mt-2" th:each="p:${products}">
										<div class="card card-sh h-100">
											<div class="card-body text-center">
												<img alt="[[${p.title}]]" th:src="@{'/img/product_img/'+${p.image}}"
													width="100%" height="150px" style="object-fit: contain;">
												<p class="fs-5 text-center mt-2">[[${p.title}]]</p>
												<div class="text-center">
													<p class="fs-6 fw-bold mb-1">
														<span>
														    <th:block th:utext="${@commnServiceImpl.rupeeSign()}"></th:block> 
														    [[${p.discountPrice}]]
														</span>
													</p>
													<p class="mb-2">
														<span class="text-decoration-line-through text-secondary">
															<th:block th:utext="${@commnServiceImpl.rupeeSign()}"></th:block> 
															[[${p.price}]]
														</span> 
														<span class="fs-6 text-success">[[${p.discount}]]% off</span>
													</p>
													<a th:href="@{'/product/'+${p.id}}"
														class="btn btn-primary">View Details</a>
												</div>
											</div>
										</div>
									</div>
								</th:block>
								
								<th:block th:unless="${products.size() > 0}">
									<div class="col-12 text-center py-5">
										<i class="bi bi-search" style="font-size: 3rem; color: #6c757d;"></i>
										<h4 class="mt-3 text-muted">No products found</h4>
										<p class="text-muted">Try adjusting your search or filter criteria</p>
										<a href="/products" class="btn btn-primary mt-2">
											Browse All Products
										</a>
									</div>
								</th:block>
							</div>
						</div>
					</div>
					
					<!-- Pagination -->
					<th:block th:if="${products.size() > 0}">
						<div class="row mt-4">
							<div class="col-md-6">
								<p class="text-muted">Showing [[${products.size()}]] of [[${totalElements}]] products</p>
							</div>
							<div class="col-md-6">
								<nav aria-label="Product navigation">
									<ul class="pagination justify-content-end">
										<li class="page-item" th:classappend="${isFirst} ? 'disabled':''">
											<a class="page-link" th:href="@{'/products?pageNo='+${pageNo-1}}"
												aria-label="Previous">
												<span aria-hidden="true">&laquo;</span>
											</a>
										</li>

										<li th:each="i:${#numbers.sequence(1,totalPages)}" class="page-item" 
											th:classappend="${pageNo+1==i}?'active':''">
											<a class="page-link" th:href="@{'/products?pageNo='+${i-1}}">[[${i}]]</a>
										</li>

										<li class="page-item" th:classappend="${isLast} ? 'disabled':''">
											<a class="page-link" th:href="@{'/products?pageNo='+${pageNo+1}}"
												aria-label="Next">
												<span aria-hidden="true">&raquo;</span>
											</a>
										</li>
									</ul>
								</nav>
							</div>
						</div>
					</th:block>
				</div>
			</div>
		</div>
	</section>
</body>
</html>